# AvaLink-Python

简介：基于Python和Streamlit的二维结构力学求解Web小程序 / A structural mechanics (2D) solution Web applet based on Python and Streamlit

### 🔑 项目简介 (版本：beta-v0.1)

💡   本项目是基于结构力学矩阵位移法理论（二维）开发的平面结构力学求解器，主体由Python语言（包括其标准库、第三方库）编写，利用Streamlit框架进行Web端可视化。该求解小程序的主要工作流程及功能如下：

* 前处理环节：采用"上传模板表格"的方式，建立由**欧拉梁单元**组成结构体系，并施加荷载；
* 求解环节：组成刚度矩阵，通过求解矩阵方程得到杆端位移、杆端力；
* 后处理环节：将计算结果（杆端力、杆端位移）以表格的形式呈现，并展示结构的变形图、弯矩图、剪力图。

💡  本项目已在Streamlit Community Cloud上发布，线上体验地址及模板下载地址如下：

* 发布网址：[https://avalink-python.streamlit.app/](https://avalink-python.streamlit.app/)
* 结构荷载模板(template.xlsx)下载：[点击这里](https://pan.baidu.com/s/1E73EST3i5VXj6ZhZs_SNBA?pwd=s543)，百度网盘提取码 (s543)

---

### 🔑 使用方法 (Web端)

💡   若不自行下载源码进行调试，则可通过访问Web端链接来使用：`https://avalink-python.streamlit.app/`，下面将简要说明如何利用模板表格进行结构建模、施加荷载，最后在提交数据。

##### 一、下载模板表格并打开编辑

💡   进入程序后界面如图所示，可点击蓝色的“template.xlsx”进入百度网盘链接进行下载，或直接访问“项目简介”中的链接，下载表格。

![01](image/README/01.png)

💡   打开表格后，会发现它包含三个工作簿：Nodes、Elements、NodalLoad，用途如下：

* **Nodes**：用于设置节点的名称、坐标及其位移约束情况。
* **Elements**：用于将节点连接成单元，并设置其面积、弹性模量、惯性矩、单元之间连接形式等属性。
* **NodalLoad**：用于对节点施加荷载。可施加节点集中荷载与杆端集中力偶。

##### 二、模板表格中的参数含义说明

💡   填写顺序：先填写**Nodes**工作簿建立节点 (每行代表一个节点)，在此基础上填写**Elements**工作簿建立单元(每行代表一个单元)，最后填写**NodalLoad**工作簿，对节点和杆端施加荷载(每行代表一处具体荷载)。完成后，可保存并关闭xlsx文件，网页端点击“Browse files”上传文件。

💡   关于**单位制**：本程序类似ANSYS APDL，不包含各量纲的具体单位信息，建议各物理量均采用国际单位，以此确保输出结果依然为国际单位。例如：长度(m)、力(N)、力偶(N*m)。

💡   关于**Nodes**工作簿中的各项参数含义如下表：

| 参数名称 |         参数含义         |                           示例与备注                           |
| :------: | :-----------------------: | :------------------------------------------------------------: |
|   NID   |         节点编号         |         自定义即可，例如：可按自然数编号递推 (非关键)         |
|  Class  |         对象类别         |           对于节点请填写：node （注意不留多余空格）           |
|   Name   |         节点名称         | 自定义即可，建议采用大写英文字母，如A、B (不留多余空格，下同) |
|    x    |         平面x坐标         |                直接填写填写整数、小数，如5或6.2                |
|    y    |         平面y坐标         |                直接填写填写整数、小数，如5或6.2                |
|  DX约束  | 节点x方向位移被约束的情况 |     如被约束填写：Y，如未约束则填写：N，注意大写、不留空格     |
|  DY约束  | 节点y方向位移被约束的情况 |     如被约束填写：Y，如未约束则填写：N，注意大写、不留空格     |
|  DZ约束  | 节点z方向位移被约束的情况 |     如被约束填写：Y，如未约束则填写：N，注意大写、不留空格     |

💡   关于**Elements**工作簿中的各项参数含义如下表：

| 参数名称 |      参数含义      |                     示例与备注                     |
| :------: | :----------------: | :-------------------------------------------------: |
|   EID   |      单元编号      |    自定义即可，例如：可按自然数编号递推 (非关键)    |
|  Class  |      对象类别      | 对于单元请填写：Element （注意不留多余空格，下同） |
|    Pi    | 杆件单元起始端节点 |   直接填写在Nodes工作簿中定义的节点名称，如：A或B   |
|    Pj    | 杆件单元终止端节点 |   直接填写在Nodes工作簿中定义的节点名称，如：A或B   |
|    E    |   单元的弹性模量   |     直接填写数字或科学记数法形式，例如：2.06e11     |
|    A    |  单元的横截面面积  |      直接填写数字或科学记数法形式，例如：0.02      |
|    I    | 单元的弯曲轴惯性矩 |     直接填写数字或科学记数法形式，例如：3.2e-4     |

💡   关于**NodalLoad**工作簿中的各项参数含义如下表：

|     参数名称     |        参数含义        |                                                                    示例与备注                                                                    |
| :---------------: | :---------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------: |
|        LID        |        荷载编号        |                                                  自定义即可，例如：可按自然数编号递推 (非关键)                                                  |
|     LoadClass     |        荷载类别        | 直接填写F或M字母，大写且注意不要有多余空格；<br />前者代表节点集中力，后者代表杆端集中弯矩；<br />以下参数按F与M分两类，按对应类别填写，否则不填 |
|  TargetNodeName  |   集中力作用节点 (F)   |                                                 直接填写在Nodes工作簿中定义的节点名称，如：A或B                                                 |
|        Num        |     集中力数值 (F)     |                                                    填写绝对值，可采用数字或科学记数法，如5e4                                                    |
|    GlobalAngle    |   力与全局x轴夹角 (F)   |                                                  按角度制填写，如：若力为竖直向下，则填写：-90                                                  |
|  TargetElemName  |   力偶作用杆件名 (M)   |                             直接填写在Elements中定义的单元名称，举例：<br />若Pi=C，Pj=D，则单元名称为CD，不可写成DC                             |
|       NumI       |  单元i端节点弯矩值 (M)  |                                                    填写绝对值，可采用数字或科学记数法，如2500                                                    |
| RollingDirectionI | 单元i端节点弯矩方向 (M) |                           若绕杆端逆时针则填写L字母，若绕杆端顺时针则<br />填写R字母，若不存在则填写0，不要缺省该参数                           |
|       NumJ       |  单元j端节点弯矩值 (M)  |                                                    填写绝对值，可采用数字或科学记数法，如2500                                                    |
| RollingDirectionJ | 单元j端节点弯矩方向 (M) |                           若绕杆端逆时针则填写L字母，若绕杆端顺时针则<br />填写R字母，若不存在则填写0，不要缺省该参数                           |

💡   关于本计算程序中**坐标系**的说明：

* **整体坐标系**：是定义节点坐标的笛卡尔直角坐标系，原点在 (0,0)，x轴正向水平向右，y轴正向竖直向上（又名全局坐标系等）
* **局部坐标系**：是描述单元内部几何信息的笛卡尔直角坐标系，原点在杆i端节点，x轴在杆轴线上，由i端指向j端，y轴正向为x轴指向逆时针旋转90度

💡   关于参数的其它补充说明：

* 由于程序尚未有足够的健壮性，请仔细检查**是否有多余空格输入**，是否存在工作区域外的**意外字符**，这往往是计算异常的原因。
* 本程序中，规定弯矩图绘制在梁单元受拉侧；剪力以绕梁单元顺时针方向为正；轴力以受拉为正。
* 程序默认考虑杆件的轴向变形，若想忽略轴向变形，可将Elements工作簿中每个单元的面积值设为很大的数目，例如1e30

##### 三、提交计算

💡   填写完模板表格并仔细检查后，可保存并上传，注意一次仅允许上传一个文件。随后，程序将以表格的形式弹出所填数据，再度检查无误后点击“提交计算”按钮开始计算。如图：

![02](image/README/02.png)

💡   点击提交计算后，可能出现不同结果，主要为如下多种情况：

* 计算成功，进入“**后处理部分** ”并依次展示结果，可读取结果表格和位移/内力图形。
* 计算失败，返回警告：`ValueError: 表格中有不合理的数据输入，请检查后重新上传！` 这时应再次检查模板输入，确保所有输入符合“模板表格中的参数含义说明”一节的规定。此外，对结构自身进行检查，确定其并**非几何可变体系**，否则无法求解。
* 无论计算是否成功，若要更改基本数据，不能通过网页直接更改，需要在电子表格中修改并**重新上传**。

---

### 🔑 开发指南

💡   若自行下载源码进行调试，则可直接在项目源码主页点击“Code -> Download Zip”进行打包下载，或安装Git后使用命令进行下载：

```bash
git clone https://github.com/kfs196/AvaLink-Python.git
```

##### 一、依赖资源说明

💡   本项目依赖的Python第三方库主要如下：

* Streamlit： 本项目的UI框架，用于构建Web端交互界面；
* Numpy：本项目的主要计算库，用于组织管理矩阵数据并进行运算；
* Pandas：主要用于DataFrame结构化数据的组织管理，并用于前端展示；
* Matplotlib：本项目的图表绘制引擎；
* Openpyxl：用于读取操作xlsx工作表，配合Pandas进行数据组织；

💡   第三方库安装建议：可在新建环境中使用pip工具分别安装**streamlit**、**matplotlib**及**openpyxl**三个库（numpy及pandas为streamlit的依赖项，可一并自动安装）。本程序开发环境为Python3.8，依赖库版本详见文件 `requirements.txt`。举例，使用pip安装streamlit的命令为：(若安装失败可尝试升级pip版本或切换为国内镜像源)。

```bash
pip install streamlit
```

##### 二、程序结构及运行说明

💡   本项目的程序结构简要说明如下：(image文件夹为本文档图片存储位置，其它文件为非必要项)

**Avalink-Python**
│  LICENSE -> 📄 程序开源协议(BSD 3-Clause)
│  Program.py -> 📄 主程序
│  README.md -> 📄 说明文档(即为本文)
│  requirements.txt -> 📄 第三方资源说明
│  start.py -> 📄 使用python标准库启动程序的入口
│  template.xlsx -> 📄 模板表格文件
│
├─**CoreLib** -> 📁 程序核心计算库，用于读取、处理、求解和图表展示
│  │  beamClass.py -> 📄 Beam类：描述梁单元特征
│  │  loadClass.py -> 📄 LoadForce类与LoadMoment类：描述作用于节点的集中力荷载
│  │  nodeClass.py -> 📄 Node类：用于描述节点的基本属性
│  │  readFileClass.py -> 📄 Node类：用于描述节点的基本属性
│  │  structureClass.py -> 📄 Readfile类：用于读取模板数据并整理、规范化的工具箱
│  │  visualClass.py -> 📄 Visual类：根据计算结果，对结构位移、内力进行可视化的工具类
│
├─**GUI** -> 📁 程序的Web端交互界面库
│  │  streamClass.py -> 📄 Stream类：搭建Web端交互界面的程序

💡   本项目的运行方式：搭建Python环境及安装必要的第三方库后，通过Streamlit运行主程序 `Program.py`即可启动本地服务器。在终端输入：

```bash
python -m streamlit run your_path
```

回车运行即可。其中“your_path”是主程序文件 `Program.py`的路径/相对路径。或在此环境下用python解释器运行 `start.py`，本质同上。

💡   更多基于Streamlit的交互功能实现可参见其官网文档：`https://docs.streamlit.io/`

---

### 🔑 其它补充说明

💡  作者为土木工程专业2023届本科毕业生，开发本程序的初心是尝试探索结构分析程序设计方法、进行知识分享交流。目前该程序存在几何建模功能少、界面交互体验较差、无图形交互、仅支持二维欧拉梁单元分析、暂不支持分布荷载自动施加、异常处理能力薄弱、不支持图表矢量导出等众多不足，以上问题在今后的学习工作中尝试优化。在此也恳请各路大神提出宝贵意见，联系邮箱：`kfs196@126.com`。

💡  致谢：首先特别感谢大学本科期间众多恩师，他们的悉心教导、辛苦付出，让我收获了建立此项目所需的基本知识与能力。此外，很感谢深圳大学土木与交通工程学院陈老师，他在B站上的公开课程给与了我很大的帮助(Up主：[像素笑声工作室](https://space.bilibili.com/671448327))。当然，也感谢Python各种强大的第三方库，让我可以“在巨人的肩膀上”仰望星辰。
